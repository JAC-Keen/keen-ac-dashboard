<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Keen Auto-Collector Dashboard</title>
    <link rel="shortcut icon" href="https://keen.io/assets/images/favicon.ico"/>
    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link href="https://cdn.jsdelivr.net/npm/keen-dataviz@3/dist/keen-dataviz.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="./assets/keen-dashboards.css" />
    <link rel="stylesheet" href="./assets/demo-styles.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <!-- THEMES -->
    <link rel="stylesheet" href="./themes/dashboard.css" />
    <!-- JS -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/keen-analysis@3"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/keen-dataviz@3/dist/keen-dataviz.min.js"></script>
    <!-- Keen Setttings -->

    <script>
    (function(name,path,ctx){ctx[name]=ctx[name]||{ready:function(fn){var h=document.getElementsByTagName('head')[0],s=document.createElement('script'),w=window,loaded;s.onload=s.onerror=s.onreadystatechange=function(){if((s.readyState&&!(/^c|loade/.test(s.readyState)))||loaded){return}s.onload=s.onreadystatechange=null;loaded=1;ctx[name].ready(fn)};s.async=1;s.src=path;h.parentNode.insertBefore(s,h)}}})
    ('KeenTracking', 'https://cdn.jsdelivr.net/npm/keen-tracking@4', this);

    KeenTracking.ready(function(){
      const client = new KeenTracking({
      //  requestType: 'beaconAPI',
        projectId: '5be57e50c9e77c0001a1255a',
        writeKey: '730658AD24CEE33C6EF5973985488F0BA3EF141BFBE10EA9730D0199938AF4587163B7C21AA3B9EF4A8E6D4C0E070C28ADA72A97B06052BD6BE28885DEAF096B2210BC67BCAF72F21EFDC58377D35A27CF246AB1FAEF8ABD990435E0C432E36F'
      });
      client.initAutoTracking();

      let usage = 50;

      const generate = () => {
        setTimeout(() => {
          usage += Math.round(Math.random()*usage*0.3);
          usage -= Math.round(Math.random()*usage*0.3);
          if(usage<0){
            usage = 0;
          }
          if(usage>100){
            usage = 100;
          }
          client.recordEvent('cpu', {
            usage
          });
          generate();
        }, 333000);
      };

      //generate();

const chart = new KeenDataviz({
  container: '#chart', // querySelector
  title: 'New Customers per Week'
});

// Use keen-analysis.js to run a query
const clientx = new KeenAnalysis({
  projectId: '5be57e50c9e77c0001a1255a',
  readKey: 'DD0C57B32A59963A3BE48C67A2EBB3E0C0B8A49BAF2A31A0951159A3BC8703FAC67D027435B9BD325484C2BB235D8BC1DE2F054BBC607C6A4F1D858A736D2D1B54C7B0F66484669FB5B45F8099661C45C1BE73089BDD8380E1ED3AB651C4F76A'
});

const generatex = () => {
  setTimeout(() => {

  generatex();
}, 5000);
};

generatex();
clientx
  .query({
    analysis_type: 'count',
    event_collection: 'cpu',
    timeframe: {
      start: '2018-11-09T13:00:00.000Z',
      end: '2018-11-09T13:40:00.000Z'
    },
    interval: 'minutely',
    group_by: 'keen.timestamp'
  })
  .then(function(results){
    // pass the result to the chart
    chart
      .render(results);
      window.c=chart;
      setTimeout(() => {
        clientx
          .query({
            analysis_type: 'count',
            event_collection: 'cpu',
            timeframe: {
              start: '2018-11-09T13:00:00.000Z',
              end: '2018-11-09T13:50:00.000Z'
            },
            interval: 'minutely',
            group_by: 'keen.timestamp'
          })
          .then(function(results){

            chart
              .render(results);
            })
    }, 15000);
  })
  .catch(function(error){
    // on error
    chart
      .message(error.message);
  });

    });




    </script>

    <style>
#chart{
  width:100%;
  height:500px;
}
    </style>
  </head>
  <body class="demo-theme-dashboard" >

<a href="#" id="bbb">AAAA1111</a>
<a href="#" id="aaa" data-event-key="sosox">22222</a>


<a href="http://github.com" target="_blank">BBBB</a>
<a download href="server.js">BBBB</a>

    <div id="chart">

    </div>

  </body>
</html>
